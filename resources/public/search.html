<!DOCTYPE html>
<html>
<head>
    <title>Notepad</title>
    <!--script src="/jslib/bootstrap/js/bootstrap.js"></script-->
    <script src="/jslib/closure-library/closure/goog/base.js"></script>
    <script>
        goog.require('goog.dom');
        goog.require('goog.events');
        goog.require('goog.events.EventType');
        goog.require('goog.ui.Control');
        goog.require('goog.ui.ControlRenderer');
        goog.require('goog.ui.Textarea');
        goog.require('goog.ui.TextareaRenderer');
        goog.require('goog.userAgent');
        goog.require('goog.net.XhrIo');
    </script>
    <script src="search.js"></script>
    <link rel="stylesheet" href="/css/search.css">
    <link rel="stylesheet" href="/jslib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="/jslib/bootstrap/css/bootstrap-responsive.css">

</head>
</head>
<body>
<div class="container">

    <div class="height:50px"></div>

    <div class="row">
        <div class="span2">Search:</div>
        <div class="span9">
            <textarea id="searchInput" style="width: 60em; height: 1em;"></textarea>
        </div>
    </div>

    <div class="row">
        <div id="classes" class="span5"></div>
        <div id="libs" class="span5"></div>
    </div>

    <script>

        function showSearchResults(x, e) {

            var dom_ = new goog.dom.DomHelper();
            dom_.removeChildren(classesContainer);
            dom_.removeChildren(libsContainer);

            obj = x.getResponseJson();

            totalClasses = obj['totalClasses'];
            goog.dom.appendChild(classesContainer, goog.dom.createDom('div', {'class': 'title'}, 'Found ' + totalClasses + ' classes'));

            classes = obj['classes'];
            for (i = 0; i < classes.length; i++) {
                var jc = new tutorial.notepad.JavaClass(classes[i]['packageName'], classes[i]['className'], classesContainer);
                jc.makeDom();
            }

            totalLibs = obj['totalLibs'];
            goog.dom.appendChild(libsContainer, goog.dom.createDom('div', {'class': 'title'}, 'Found ' + totalLibs + ' libs'));

            classes = obj['libs'];
            for (i = 0; i < classes.length; i++) {
                var l = new tutorial.notepad.JavaLib(classes[i]['packageId'], classes[i]['artifactId'], libsContainer);
                l.makeDom();

            }

        }


        var searchInput = goog.dom.getElement('searchInput');
        var classesContainer = goog.dom.getElement('classes');
        var libsContainer = goog.dom.getElement('libs');

        // var ac1 = new goog.ui.AutoComplete.RichRemote("/service.json", input1);
        var taSearch = new goog.ui.Textarea();

        taSearch.decorate(searchInput);
        goog.events.listen(searchInput,
                goog.events.EventType.KEYUP,
                function(e) {
                    if (this.value.length > 2) {
                        var xhr = new goog.net.XhrIo();
                        xhr.send('/search?token=' + this.value);
                        goog.events.listen(xhr, goog.net.EventType.COMPLETE, function(e) {
                            showSearchResults(this, e);
                        });
                    }
                });


    </script>
</div>
</body>
</html>
